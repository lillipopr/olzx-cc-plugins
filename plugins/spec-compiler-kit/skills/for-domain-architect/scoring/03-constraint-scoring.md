# 约束定义评分标准

> **满分**：100 分
> **及格分**：60 分
> **推荐分**：85 分以上
> **权重**：25%

---

## 评分维度

约束定义从 6 个维度评分，每个维度有具体的评分项。

| 维度 | 满分 | 说明 |
|------|------|------|
| 状态定义 | 15 分 | 状态空间定义、状态设计原则 |
| 状态转移 | 20 分 | 转移表完整性、伪代码正确性 |
| 不变量定义 | 30 分 | 三测试、伪代码、跨端实现 |
| 禁止态说明 | 15 分 | 禁止态完整性、伪代码 |
| 约束执行时机 | 10 分 | 执行时机定义、执行位置 |
| 约束违反处理 | 10 分 | 优先级定义、处理策略 |

---

## 一、状态定义（15 分）

### 1.1 状态空间完整性（8 分）

| 评分项 | 满分 | 评分标准 |
|--------|------|----------|
| **状态互斥** | 3 分 | 状态之间互斥，同一时刻只能处于一个状态（3 分符合，0 分不符合） |
| **状态完备** | 3 分 | 状态覆盖所有可能情况（3 分完备，1 分基本完备，0 分不完备） |
| **无孤岛状态** | 2 分 | 每个状态可达可离（2 分符合，0 分不符合） |

**扣分项**：
- 状态重叠：状态之间有重叠扣 2 分/处
- 状态遗漏：遗漏必要状态扣 2 分/个
- 孤岛状态：存在无法到达或离开的状态扣 2 分/个

---

### 1.2 状态定义规范（7 分）

| 评分项 | 满分 | 评分标准 |
|--------|------|----------|
| **状态码规范** | 2 分 | 使用 S0, S1, S2... 格式（2 分规范，1 分基本规范，0 分不规范） |
| **状态名称明确** | 2 分 | 状态名称语义明确（2 分明确，1 分可理解，0 分模糊） |
| **含义说明** | 2 分 | 每个状态都有含义说明（2 分完整，1 分部分完整，0 分缺失） |
| **可转移状态** | 1 分 | 列出可转移状态（1 分完整，0 分缺失） |

**扣分项**：
- 状态码不规范：未使用标准格式扣 1 分
- 名称模糊：状态名称无法理解扣 1 分/个
- 含义未说明：状态无含义说明扣 1 分/个
- 可转移状态缺失：未列出可转移状态扣 1 分/个

---

## 二、状态转移（20 分）

### 2.1 状态转移表完整性（10 分）

| 评分项 | 满分 | 评分标准 |
|--------|------|----------|
| **转移完整性** | 5 分 | 所有可能的状态转移都已定义（5 分完整，3 分基本完整，0 分缺失） |
| **行为类型标注** | 3 分 | 每个转移都标注行为类型（用户/系统）（3 分完整，1 分部分完整，0 分缺失） |
| **约束条件** | 2 分 | 每个转移都定义约束条件（2 分完整，1 分部分完整，0 分缺失） |

**扣分项**：
- 转移遗漏：遗漏必要的状态转移扣 2 分/处
- 行为类型未标注：未标注行为类型扣 1 分/处
- 约束条件缺失：未定义约束条件扣 1 分/处

---

### 2.2 状态转移伪代码（10 分）

| 评分项 | 满分 | 评分标准 |
|--------|------|----------|
| **语法正确** | 3 分 | 伪代码语法正确（3 分正确，1 分基本正确，0 分错误） |
| **逻辑完整** | 4 分 | 包含状态验证、约束验证、异常处理（4 分完整，2 分部分完整，0 分缺失） |
| **无平台特定语法** | 3 分 | 不包含特定编程语言语法（3 分符合，0 分不符合） |

**扣分项**：
- 语法错误：伪代码语法错误扣 1 分/处
- 逻辑缺失：缺少验证步骤扣 2 分/处
- 平台特定：包含 Java/Swift/JS 等语法扣 3 分

---

## 三、不变量定义（30 分，最高权重）

### 3.1 不变量三测试（15 分）

每个不变量必须通过三个测试，按比例评分：

| 测试项 | 满分 | 说明 |
|--------|------|------|
| **可执行** | 5 分 | 能写成 assert 语句 |
| **可测试** | 5 分 | 能设计用例验证 |
| **可解释** | 5 分 | 能解释为什么必须成立 |

**评分标准**：

**可执行测试（5 分）**：
- 5 分：所有不变量都能写成 assert
- 3 分：80% 以上不变量可执行
- 0 分：低于 80% 不变量可执行

**可测试测试（5 分）**：
- 5 分：所有不变量都有对应用例
- 3 分：80% 以上不变量有对应用例
- 0 分：低于 80% 不变量有对应用例

**可解释测试（5 分）**：
- 5 分：所有不变量都有理论依据说明
- 3 分：80% 以上不变量有说明
- 0 分：低于 80% 不变量有说明

**扣分项**：
- 不可执行：不变量模糊无法写成 assert 扣 1 分/个
- 不可测试：不变量无法设计用例扣 1 分/个
- 不可解释：不变量无理论依据扣 1 分/个

---

### 3.2 不变量伪代码（8 分）

| 评分项 | 满分 | 评分标准 |
|--------|------|----------|
| **伪代码格式** | 3 分 | 使用统一的伪代码格式（3 分统一，1 分基本统一，0 分不统一） |
| **ASSERT 语句** | 3 分 | 每个约束都使用 ASSERT 语句（3 分完整，1 分部分完整，0 分缺失） |
| **错误信息** | 2 分 | 包含明确的错误信息（2 分明确，1 分可理解，0 分模糊） |

**扣分项**：
- 格式不统一：伪代码格式不一致扣 1 分/处
- 缺少 ASSERT：未使用 ASSERT 语句扣 2 分/个
- 错误信息模糊：错误信息不明确扣 1 分/个

---

### 3.3 各端实现位置（7 分）

| 评分项 | 满分 | 评分标准 |
|--------|------|----------|
| **实现层级** | 3 分 | 每个约束都标注实现层级（Domain/Application）（3 分完整，1 分部分完整，0 分缺失） |
| **文件位置** | 2 分 | 每个约束都标注文件位置（2 分完整，1 分部分完整，0 分缺失） |
| **方法名称** | 2 分 | 每个约束都标注方法名称（2 分完整，1 分部分完整，0 分缺失） |

**扣分项**：
- 层级未标注：未标注实现层级扣 1 分/个
- 文件未标注：未标注文件位置扣 1 分/个
- 方法未标注：未标注方法名称扣 1 分/个

---

## 四、禁止态说明（15 分）

### 4.1 禁止态完整性（8 分）

| 评分项 | 满分 | 评分标准 |
|--------|------|----------|
| **禁止态识别** | 4 分 | 所有禁止的状态转移都已识别（4 分完整，2 分基本完整，0 分缺失） |
| **禁止原因** | 4 分 | 每个禁止态都有明确原因（4 分明确，2 分可理解，0 分模糊） |

**扣分项**：
- 禁止态遗漏：遗漏禁止态扣 2 分/处
- 原因模糊：禁止原因不明确扣 1 分/处

---

### 4.2 禁止态伪代码（7 分）

| 评分项 | 满分 | 评分标准 |
|--------|------|----------|
| **PROHIBITED_TRANSITIONS** | 3 分 | 定义禁止转移字典（3 分定义，0 分未定义） |
| **validate_not_prohibited** | 3 分 | 定义验证函数（3 分定义，0 分未定义） |
| **错误信息** | 1 分 | 包含禁止原因的错误信息（1 分包含，0 分不包含） |

**扣分项**：
- 字典未定义：未定义禁止转移字典扣 3 分
- 函数未定义：未定义验证函数扣 3 分
- 原因未包含：错误信息不包含原因扣 1 分

---

## 五、约束执行时机（10 分）

### 5.1 执行时机定义（6 分）

| 评分项 | 满分 | 评分标准 |
|--------|------|----------|
| **时机明确** | 3 分 | 每个约束执行时机明确（创建时/操作时/状态变更时）（3 分明确，1 分部分明确，0 分不明确） |
| **执行位置** | 3 分 | 每个约束执行位置明确（Domain 层/Application 层）（3 分明确，1 分部分明确，0 分不明确） |

**扣分项**：
- 时机不明：执行时机不明确扣 1 分/个
- 位置不明：执行位置不明确扣 1 分/个

---

### 5.2 失败处理（4 分）

| 评分项 | 满分 | 评分标准 |
|--------|------|----------|
| **处理方式** | 2 分 | 每个约束失败处理方式明确（抛异常/返回错误）（2 分明确，1 分部分明确，0 分不明确） |
| **处理描述** | 2 分 | 处理描述清晰（2 分清晰，1 分可理解，0 分模糊） |

**扣分项**：
- 处理未定义：未定义失败处理扣 2 分/个
- 描述模糊：处理描述模糊扣 1 分/个

---

## 六、约束违反处理策略（10 分）

### 6.1 约束优先级（5 分）

| 评分项 | 满分 | 评分标准 |
|--------|------|----------|
| **优先级定义** | 3 分 | P0/P1/P2/P3 优先级定义清晰（3 分清晰，1 分可理解，0 分模糊） |
| **优先级分配** | 2 分 | 每个约束都有优先级（2 分完整，1 分部分完整，0 分缺失） |

**扣分项**：
- 定义模糊：优先级定义模糊扣 2 分
- 优先级缺失：约束未分配优先级扣 1 分/个

---

### 6.2 处理策略表（5 分）

| 评分项 | 满分 | 评分标准 |
|--------|------|----------|
| **处理策略** | 3 分 | 每个优先级对应处理策略（3 分完整，1 分部分完整，0 分缺失） |
| **恢复方式** | 2 分 | 每个约束都有恢复方式（2 分完整，1 分部分完整，0 分缺失） |

**扣分项**：
- 策略缺失：优先级无对应处理策略扣 1 分/个
- 恢复未定义：约束无恢复方式扣 1 分/个

---

## 评分示例

### 优秀示例（95 分）

```
状态定义：
- 状态互斥：3/3
- 状态完备：3/3
- 无孤岛状态：2/2
- 状态码规范：2/2
- 状态名称明确：2/2
- 含义说明：2/2
- 可转移状态：1/1
小计：15/15

状态转移：
- 转移完整性：5/5
- 行为类型标注：3/3
- 约束条件：2/2
- 语法正确：3/3
- 逻辑完整：4/4
- 无平台特定语法：3/3
小计：20/20

不变量定义：
- 可执行：5/5
- 可测试：5/5
- 可解释：5/5
- 伪代码格式：3/3
- ASSERT 语句：3/3
- 错误信息：2/2
- 实现层级：3/3
- 文件位置：2/2
- 方法名称：2/2
小计：30/30

禁止态说明：
- 禁止态识别：4/4
- 禁止原因：4/4
- PROHIBITED_TRANSITIONS：3/3
- validate_not_prohibited：3/3
- 错误信息：1/1
小计：15/15

约束执行时机：
- 时机明确：3/3
- 执行位置：3/3
- 处理方式：2/2
- 处理描述：2/2
小计：10/10

约束违反处理策略：
- 优先级定义：3/3
- 优先级分配：2/2
- 处理策略：3/3
- 恢复方式：2/2
小计：10/10

总分：100/100
```

---

## 常见扣分项汇总

| 问题 | 扣分 |
|------|------|
| 状态重叠 | -2 分/处 |
| 状态遗漏 | -2 分/个 |
| 状态转移遗漏 | -2 分/处 |
| 伪代码含平台特定语法 | -3 分 |
| 不变量不可执行 | -1 分/个 |
| 不变量不可测试 | -1 分/个 |
| 不变量不可解释 | -1 分/个 |
| 缺少 ASSERT 语句 | -2 分/个 |
| 各端实现位置未标注 | -1 分/个 |
| 禁止态遗漏 | -2 分/处 |
| 执行时机不明 | -1 分/个 |
| 优先级未分配 | -1 分/个 |
