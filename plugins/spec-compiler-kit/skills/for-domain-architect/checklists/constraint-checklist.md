# 约束设计检查清单

## 使用说明

本检查清单用于验证《领域设计文档》第三部分（约束定义）的完整性和质量。

---

## 状态定义检查

### 完整性

- [ ] 每个实体都有状态定义表
- [ ] 状态定义完备（覆盖所有可能情况）
- [ ] 状态定义互斥（同一时刻只能处于一个状态）
- [ ] 每个实体至少有 2 个状态（初始状态 + 至少一个转移状态）

### 格式规范

- [ ] 使用状态码 + 状态名的格式（如 S0: 待支付）
- [ ] 状态名称清晰易懂
- [ ] 状态含义有明确说明
- [ ] 可转移状态已列出

### 质量检查

- [ ] 无孤岛状态（每个状态可达可离）
- [ ] 状态划分合理（不过细也不过粗）

---

## 状态转移检查

### 完整性

- [ ] 每个状态转移都有定义
- [ ] 状态转移表无遗漏
- [ ] 每个转移都标注了触发行为
- [ ] 每个转移都标注了行为类型（用户/系统）

### 格式规范

- [ ] 状态转移表格式正确
- [ ] 约束条件已明确
- [ ] 状态转移伪代码符合规范

### 质量检查

- [ ] 状态转移无循环依赖
- [ ] 状态转移路径合理
- [ ] 状态转移可达性正确

---

## 不变量检查

### 三测试验证

每个不变量必须通过三个测试：

#### 可执行性

- [ ] 每个不变量都能写成 assert 语句
- [ ] 不变量使用伪代码定义（不绑定语言）
- [ ] 伪代码语法正确，无歧义

#### 可测试性

- [ ] 每个不变量至少有一个用例覆盖
- [ ] 用例可以直接转化为测试代码
- [ ] 用例验证方式已明确（后端/iOS/前端）

#### 可解释性

- [ ] 每个不变量都有清晰的业务解释
- [ ] 解释说明了"为什么"而不仅仅是"是什么"
- [ ] 理论依据已注明

### 完整性

- [ ] 结构约束已定义（至少 1 条）
- [ ] 业务约束已定义（至少 2 条）
- [ ] 状态约束已定义（至少 1 条）
- [ ] 版本约束已定义（如需要）
- [ ] 可解释性约束已定义（如需要）

### 格式规范

- [ ] 每个不变量有唯一 ID（如 INV-01）
- [ ] 约束描述清晰简洁
- [ ] 伪代码符合规范
- [ ] 各端实现位置已明确

### 质量检查

- [ ] 不变量之间无重复
- [ ] 不变量之间无冲突
- [ ] 不变量符合最小化原则
- [ ] 不变量符合独立性原则
- [ ] 不变量符合可验证原则

---

## 禁止态检查

### 完整性

- [ ] 所有非法状态转移都已定义
- [ ] 每个禁止态都有明确的禁止原因
- [ ] 禁止态覆盖了所有边界情况

### 格式规范

- [ ] 禁止态有唯一 ID（如 禁止态-1）
- [ ] 禁止原因清晰
- [ ] 禁止态伪代码符合规范

### 质量检查

- [ ] 禁止态定义合理（不过度限制）
- [ ] 禁止态与状态转移表一致
- [ ] 每个禁止态都有对应的 Bad Case

---

## 约束执行时机检查

### 完整性

- [ ] 每个约束都定义了执行时机
- [ ] 执行时机选择合理
- [ ] 执行位置已明确（Domain/Application 层）

### 格式规范

- [ ] 执行时机表格式正确
- [ ] 失败处理方式已明确

### 质量检查

- [ ] 结构约束在实体创建/更新时执行
- [ ] 业务约束在业务操作前执行
- [ ] 状态约束在状态变更时执行

---

## 约束违反处理策略检查

### 完整性

- [ ] 每个约束都定义了优先级
- [ ] 优先级分配合理
- [ ] 失败处理方式已明确

### 格式规范

- [ ] 优先级定义清晰（P0/P1/P2/P3）
- [ ] 处理策略表格式正确

### 质量检查

- [ ] P0 约束有明确的回滚机制
- [ ] P1 约束有清晰的错误信息
- [ ] P2/P3 约束有日志记录

---

## 跨端一致性检查

### 完整性

- [ ] 约束定义不包含任何平台特定的语法
- [ ] 伪代码使用统一的语言无关语法
- [ ] 各端实现位置已映射

### 格式规范

- [ ] 各端实现位置表格式正确
- [ ] 文件名和方法名明确

### 质量检查

- [ ] 约束在各端的实现语义一致
- [ ] 后端/iOS/前端都考虑到了
- [ ] 前端依赖后端校验的约束已标注

---

## 闸口检查

在进入下一阶段前，必须确认：

- [ ] 每个不变量至少对应一个约束定义
- [ ] 每个约束都有伪代码定义（可执行）
- [ ] 每个约束都标注了各端实现位置
- [ ] 约束覆盖结构、业务、状态三类
- [ ] P0 级别约束有明确的回滚机制
- [ ] 状态转移表完整
- [ ] 禁止态已全部定义
- [ ] 约束执行时机已明确
- [ ] 无平台特定语法

---

## 常见问题检查

### ❌ 约束描述模糊

- [ ] 没有使用"一般情况下"、"应该"、"尽量"等模糊词汇
- [ ] 约束描述使用"必须"、"始终"等明确词汇

### ❌ 约束不可执行

- [ ] 每个约束都可以写成 assert 语句
- [ ] 没有使用"用户友好"等主观描述

### ❌ 约束重复或冲突

- [ ] 没有重复定义相同含义的约束
- [ ] 没有相互冲突的约束

---

**检查完成** → 继续第四部分（用例设计）
