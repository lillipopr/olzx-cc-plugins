# 第三章检查清单：领域服务设计

## 使用说明
- **何时使用**：完成第三章（领域服务）设计后
- **预计耗时**：5-10 分钟
- **通过标准**：所有核心项检查通过

---

## 核心检查项

### 1. 领域服务识别（Step 1）

#### 识别标准
- [ ] 所有领域服务已识别
  - 涉及多个聚合的逻辑
  - 不属于特定实体的逻辑
  - 复杂计算逻辑

#### 与聚合根行为区分
- [ ] 服务不包含实体的行为
  - 实体行为保留在聚合根中
  - 领域服务只处理跨聚合或无自然归属的逻辑

#### 决策树验证
- [ ] 使用决策树验证每个服务
  - 涉及多个聚合吗？→ 是 → 领域服务
  - 属于某个实体吗？→ 是 → 实体行为
  - 是复杂计算吗？→ 是 → 领域服务

---

### 2. 领域服务列表（Step 2）

#### 服务列表完整性
- [ ] 服务列表包含所有领域服务
  - 服务名称、职责、涉及聚合、优先级

#### 命名规范
- [ ] 服务命名符合规范
  - 格式：聚合名 + Domain（如 MembershipDomain、CouponDomain）
  - 不使用 XxxService（与 Application 层混淆）
  - 不使用 XxxDomainService（繁琐）
  - 不使用中文命名

---

### 3. 服务详细设计（Step 3）

#### 方法签名
- [ ] 每个服务都有方法签名
  - 格式：`{方法名}(params: { {参数1}: {类型1} }): {返回类型}`
  - 参数和返回类型明确

#### 职责描述
- [ ] 服务职责清晰
  - 每个服务有明确的职责描述
  - 职责不重叠

#### 约束定义
- [ ] 每个服务都有约束定义
  - 约束ID格式：BIZ-{服务缩写}-NN
  - 包含类型、描述、伪代码、执行时机
  - 伪代码格式：`ASSERT {条件表达式}`

#### 用例设计
- [ ] 每个服务都有用例设计
  - 正向场景（N1, N2...）
  - 约束违反场景（B1, B2...）
  - 边界场景（E1, E2...）
  - 用例包含 Given、When、Then、验证约束

---

### 4. 领域服务设计原则

#### 状态管理
- [ ] 服务不修改聚合状态（或协调多个聚合）
  - 无状态：不持有聚合引用
  - 协调：通过调用聚合根行为来修改状态
  - 不直接操作聚合根属性

#### 协作模式
- [ ] 领域服务正确协作聚合根
  - 业务验证在领域服务
  - 状态修改在聚合根
  - 示例：`from.deductPoints(amount)` 而非 `from.points -= amount`

---

## 快速验证

### 关键指标
- [ ] 领域服务数量：每个上下文 2-5 个
- [ ] 服务方法数量：每个服务 3-7 个方法
- [ ] 约束覆盖：每个服务至少 1 个约束
- [ ] 用例覆盖：每个服务至少 3 个用例（1 正向、1 违反、1 边界）

### 设计验证
- [ ] 画出了领域服务与聚合的关系图
- [ ] 标注了服务涉及的聚合
- [ ] 标注了服务优先级

---

## 常见问题

**Q: 领域服务和聚合根行为有什么区别？**
A: 聚合根行为是单个聚合内的逻辑，直接修改聚合状态；领域服务是跨聚合或无自然归属的逻辑，通过调用聚合根行为来实现。

**Q: 领域服务可以修改聚合状态吗？**
A: 不直接修改。领域服务应该通过调用聚合根的行为来修改状态。

**Q: 如何判断逻辑应该放在领域服务还是聚合根中？**
A: 问三个问题：1) 涉及多个聚合吗？→ 领域服务；2) 属于某个实体吗？→ 聚合根行为；3) 是复杂计算吗？→ 领域服务。

---

## 原则追溯

本检查清单基于第三章章节指令：
- Step 1（1.1-1.3）：领域服务判断
- Step 2（2.1-2.2）：领域服务列表
- Step 3（3.1-3.4）：服务详细设计

参考文档：[references/principles/domain-service.md](references/principles/domain-service.md)
