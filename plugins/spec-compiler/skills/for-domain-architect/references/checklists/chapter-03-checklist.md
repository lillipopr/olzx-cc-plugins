# 第三章检查清单：领域服务设计

## 使用说明
- **何时使用**：完成第三章（领域服务）设计后
- **预计耗时**：5-10 分钟
- **通过标准**：所有核心项检查通过

---

## 核心检查项

### 1. 领域服务识别

#### 识别标准
- [ ] 通过识别标准判断领域服务
  - 涉及多个聚合
  - 不属于特定实体
  - 复杂计算

#### 与聚合根行为区分
- [ ] 优先将行为放在聚合根中
  - 聚合根行为：单个聚合内、修改聚合状态
  - 领域服务：跨聚合或无自然归属、不修改聚合状态（或协调多个聚合）

#### 识别决策
- [ ] 使用决策树验证
  - 涉及多个聚合吗？→ 是 → 领域服务
  - 属于某个实体吗？→ 是 → 实体行为
  - 是复杂计算吗？→ 是 → 领域服务

---

### 2. 领域服务设计

#### 无状态原则
- [ ] 领域服务无状态
  - 不持有聚合的引用
  - 方法接收参数，返回结果

#### 协调原则
- [ ] 领域服务协调多个聚合
  - 通过调用聚合根行为来实现逻辑
  - 不直接修改聚合状态

#### 命名规范
- [ ] 领域服务命名符合规范
  - 格式：聚合名 + Domain
  - 示例：MembershipDomain、CouponDomain、PaymentDomain
- [ ] 不与 Application 层混淆
  - 不使用 XxxService 命名

---

### 3. 领域服务职责

#### 跨聚合协调
- [ ] 跨聚合协调放在领域服务中
  - 示例：订单履约涉及订单、库存、发货

#### 复杂计算
- [ ] 复杂计算逻辑放在领域服务中
  - 示例：价格计算引擎、折扣计算

#### 值对象创建
- [ ] 复杂的值对象创建逻辑放在领域服务中
  - 示例：MoneyFactory、ConverterFactory

---

### 4. 领域服务与聚合根协作

#### 调用聚合根行为
- [ ] 领域服务通过调用聚合根行为来实现逻辑
  - 不直接操作聚合根属性
  - 业务验证在领域服务，状态修改在聚合根

#### 事务边界
- [ ] 领域服务不管理事务
  - 事务管理在应用层
  - 领域服务只负责业务逻辑

---

### 5. 领域服务类型

#### 计算服务
- [ ] 计算服务职责清晰
  - 执行复杂计算
  - 不修改状态

#### 转换服务
- [ ] 转换服务职责清晰
  - 将一种模型转换为另一种模型
  - 示例：防腐层（ACL）

#### 协调服务
- [ ] 协调服务职责清晰
  - 协调多个聚合的操作
  - 通过聚合根行为实现

---

## 快速验证

### 关键指标
- [ ] 领域服务数量：每个上下文 2-5 个
- [ ] 服务方法数量：每个服务 3-7 个方法
- [ ] 无状态验证：所有服务方法都是无状态的
- [ ] 协作验证：领域服务调用聚合根行为，不直接修改状态

### 设计验证
- [ ] 画出了领域服务图
- [ ] 标注了服务类型（计算/转换/协调）
- [ ] 标注了服务与聚合的关系

---

## 常见问题

**Q: 领域服务和聚合根行为有什么区别？**
A: 聚合根行为是单个聚合内的逻辑，直接修改聚合状态；领域服务是跨聚合或无自然归属的逻辑，通过调用聚合根行为来实现。

**Q: 领域服务可以修改聚合状态吗？**
A: 不直接修改。领域服务应该通过调用聚合根的行为来修改状态，这样可以保证业务逻辑在聚合根中。

**Q: 领域服务需要管理事务吗？**
A: 不需要。领域服务只负责业务逻辑，事务管理在应用层。

**Q: 如何判断逻辑应该放在领域服务还是聚合根中？**
A: 问三个问题：1) 涉及多个聚合吗？→ 领域服务；2) 属于某个实体吗？→ 聚合根行为；3) 是复杂计算吗？→ 领域服务。

**Q: 领域服务可以有状态吗？**
A: 不可以。领域服务应该是无状态的，所有必要的数据通过方法参数传递。

---

## 原则追溯

本检查清单基于以下原则：
- `domain-service.md` 1.1-1.3：领域服务识别原则
- `domain-service.md` 2.1-2.3：领域服务设计原则
- `domain-service.md` 3.1-3.3：领域服务职责原则
- `domain-service.md` 4.1-4.2：领域服务与聚合根协作原则
- `domain-service.md` 5.1-5.3：领域服务类型
