# 最终审查清单：DDD 设计全流程

## 使用说明
- **何时使用**：完成所有章节设计后，进行最终审查
- **预计耗时**：15-20 分钟
- **通过标准**：所有核心项检查通过

---

## 核心检查项

### 1. 限界上下文设计审查

#### 业务能力
- [ ] 所有业务能力已识别
- [ ] 能力定义符合"动词+名词"格式
- [ ] 能力分解遵循 MECE 原则
- [ ] 能力分组合理
- [ ] 领域类型已标注（核心/支撑/通用/泛化）

#### 上下文划分
- [ ] 上下文边界清晰
- [ ] 上下文内部语言一致
- [ ] 上下文间关系已定义
- [ ] 集成模式已选择
- [ ] 防腐层需求已识别

#### 设计成果
- [ ] 画出了上下文映射图
- [ ] 标注了上下文间关系
- [ ] 定义了集成方式

---

### 2. 聚合设计审查

#### 聚合根
- [ ] 聚合根有全局唯一标识
- [ ] 聚合根是唯一入口
- [ ] 聚合边界清晰，大小合理（1-3 个实体）
- [ ] 聚合内强一致，聚合间最终一致

#### 实体和值对象
- [ ] 实体和值对象已正确区分
- [ ] 值对象不可变
- [ ] 实体只能通过聚合根访问

#### 不变量
- [ ] 不变量已识别和实现
- [ ] 不变量在聚合根方法中强制
- [ ] 一个事务只修改一个聚合

#### 设计成果
- [ ] 画出了聚合图
- [ ] 标注了聚合根、实体、值对象
- [ ] 标注了聚合间关系

---

### 3. 领域服务审查

#### 服务识别
- [ ] 领域服务已识别
- [ ] 服务命名符合规范（聚合名 + Domain）
- [ ] 服务职责清晰

#### 服务设计
- [ ] 服务无状态
- [ ] 服务不直接修改聚合状态（通过聚合根行为）
- [ ] 服务不管理事务

#### 服务类型
- [ ] 复杂计算已放在领域服务中
- [ ] 跨聚合协调已放在领域服务中

#### 设计成果
- [ ] 画出了领域服务图
- [ ] 标注了服务类型

---

### 4. 应用层审查

#### 应用服务
- [ ] 所有应用服务已识别
- [ ] 应用服务命名符合规范（聚合名 + Application）
- [ ] 应用服务方法命名符合规范

#### 职责分离
- [ ] 用户行为和系统行为已区分
- [ ] 应用层不包含业务逻辑
- [ ] 业务逻辑在领域层

#### 事务管理
- [ ] 应用层管理事务
- [ ] 一个事务只修改一个聚合

#### Command 和 DTO
- [ ] Command 和 DTO 设计合理
- [ ] Command 表示用户意图
- [ ] DTO 是数据传输对象

#### 错误处理
- [ ] 错误处理完善
- [ ] 错误分类正确（参数/权限/业务/系统）
- [ ] 异常转换正确

#### 设计成果
- [ ] 画出了应用层图
- [ ] 标注了事务边界

---

### 5. 领域事件审查

#### 事件识别
- [ ] 所有领域事件已识别
- [ ] 事件命名符合规范（过去式）
- [ ] 每个事件都有触发条件
- [ ] 每个事件都有携带数据
- [ ] 每个事件都有订阅方

#### 事件设计
- [ ] 事件是不可变的
- [ ] 事件是已经发生的事实
- [ ] 事件携带必要业务数据
- [ ] 事件只携带订阅方需要的数据

#### 事件发布和订阅
- [ ] 事件在聚合根方法中发布
- [ ] 订阅方保证幂等性
- [ ] 订阅方异常不影响发布方

#### 设计成果
- [ ] 画出了事件图
- [ ] 标注了事件发布方和订阅方

---

### 6. 入口层审查

#### Controller 层
- [ ] 所有接口都是 POST 方法
- [ ] 路径设计清晰（/api/版本/端/聚合名/动作）
- [ ] 请求参数使用 Request Body
- [ ] 参数使用 XxxParam 格式
- [ ] 不使用原始数据类型
- [ ] 响应格式统一
- [ ] 异常处理完善
- [ ] 不包含业务逻辑

#### MQ 层
- [ ] 每个消费者都有消息定义
- [ ] 每个消费者都有处理逻辑
- [ ] 每个消费者都有异常处理
- [ ] 每个消费者都有幂等性保证

#### Task 层
- [ ] 每个任务都有调度策略
- [ ] 每个任务都有执行逻辑
- [ ] 每个任务都有分布式锁
- [ ] 每个任务都有异常处理
- [ ] 每个任务都有监控指标

#### 通用
- [ ] 入口层薄，不包含业务逻辑
- [ ] 使用 DTO，不直接使用领域模型
- [ ] 参数校验分层清晰
- [ ] 接口文档完整

#### 设计成果
- [ ] 画出了接口图
- [ ] 标注了接口路径和参数

---

### 7. 架构一致性审查

#### 依赖方向
- [ ] 依赖方向正确
  - View → ViewModel → Service → Gateway → Network（iOS）
  - Controller → Application → Domain ← Gateway/Infra（Java）
  - View → Composable → Service → API → Request（Vue）

#### 分层清晰
- [ ] 分层清晰，职责明确
- [ ] 上层依赖下层，下层不依赖上层
- [ ] 依赖倒置正确

#### 命名规范
- [ ] 命名符合各层规范
- [ ] 命名统一，不混淆

---

### 8. 设计原则一致性

#### SOLID 原则
- [ ] 单一职责原则：每个类只有一个职责
- [ ] 里氏替换原则：子类可以替换父类
- [ ] 依赖倒置原则：依赖抽象而非具体
- [ ] 接口隔离原则：接口小而专注
- [ ] 开闭原则：对扩展开放，对修改关闭

#### DDD 原则
- [ ] 聚合尽可能小
- [ ] 聚合内强一致，聚合间最终一致
- [ ] 领域层不依赖任何其他层
- [ ] 应用层编排，领域层执行
- [ ] 入口层薄，不包含业务逻辑

---

## 快速验证

### 数量指标
- [ ] 限界上下文：3-8 个
- [ ] 聚合根：每个上下文 2-5 个
- [ ] 领域服务：每个上下文 2-5 个
- [ ] 领域事件：每个聚合 2-5 个
- [ ] 应用服务：每个聚合 3-8 个方法
- [ ] 接口：每个聚合 3-8 个

### 质量指标
- [ ] 聚合大小：1-3 个实体，深度 1-2 层
- [ ] 事务粒度：一个事务一个聚合
- [ ] 业务逻辑：应用层无业务逻辑
- [ ] 接口方法：100% POST
- [ ] 参数类型：100% 使用 Param 对象
- [ ] 响应格式：100% 统一响应格式

### 文档完整性
- [ ] 上下文映射图
- [ ] 聚合图
- [ ] 领域服务图
- [ ] 应用层图
- [ ] 事件图
- [ ] 接口图

---

## 常见问题

**Q: 最终审查的目的是什么？**
A: 确保所有章节的设计一致，符合 DDD 原则，没有遗漏或冲突。

**Q: 如何验证设计的一致性？**
A: 检查依赖方向、分层清晰度、命名规范、设计原则的一致性。

**Q: 如果发现不一致怎么办？**
A: 回到相关章节，根据原则进行调整，确保整体设计一致。

**Q: 最终审查需要多长时间？**
A: 通常 15-20 分钟，取决于设计的复杂度。

**Q: 最终审查通过后可以做什么？**
A: 可以开始编写代码，或者进行详细设计（如数据库设计、接口设计）。

---

## 原则追溯

本检查清单基于所有章节的原则：
- `bounded-context.md`：限界上下文相关原则
- `aggregate.md`：聚合相关原则
- `domain-service.md`：领域服务相关原则
- `application.md`：应用层相关原则
- `domain-event.md`：领域事件相关原则
- `starter.md`：入口层相关原则

---

## 审查通过标准

所有核心检查项（[ ]）都通过，即视为最终审查通过。

通过后可以：
1. 开始编写代码
2. 进行详细设计
3. 编写技术文档

未通过需要：
1. 回到相关章节
2. 根据原则调整设计
3. 重新进行最终审查
