# 最终审查清单：DDD 设计全流程

## 使用说明
- **何时使用**：完成所有章节设计后，进行最终审查
- **预计耗时**：10-15 分钟
- **通过标准**：所有核心项检查通过

---

## 核心检查项

### 1. 限界上下文设计审查

**详细检查清单**：[chapter-01-checklist.md](./chapter-01-checklist.md)

核心验证：
- [ ] 业务能力已使用"动词+名词"格式识别
- [ ] 领域类型已标注（核心/支撑/通用/泛化）
- [ ] 上下文边界清晰，数据所有权明确
- [ ] 上下文映射图完整，集成模式已定义

---

### 2. 聚合设计审查（含事件发布）

**详细检查清单**：[chapter-02-checklist.md](./chapter-02-checklist.md)

核心验证：
- [ ] 值对象、实体、聚合根已通过四问法正确识别
- [ ] 聚合边界清晰，符合"小聚合"原则
- [ ] 聚合根是唯一入口，聚合间引用通过 ID
- [ ] 聚合根行为已设计，需要发布事件的行为有完整的事件发布设计
- [ ] 聚合内强一致，聚合间最终一致

---

### 3. 领域服务设计审查

**详细检查清单**：[chapter-03-checklist.md](./chapter-03-checklist.md)

核心验证：
- [ ] 所有领域服务已识别（涉及多个聚合的逻辑）
- [ ] 服务命名符合规范（聚合名 + Domain）
- [ ] 领域服务不包含实体的行为
- [ ] 领域服务协调聚合根，不直接操作聚合根属性

---

### 4. 应用层设计审查（含事件处理）

**详细检查清单**：[chapter-04-checklist.md](./chapter-04-checklist.md)

核心验证：
- [ ] 用户行为和系统行为已正确区分
- [ ] 应用服务命名符合规范（聚合名 + Application）
- [ ] 应用层只负责编排，不包含业务逻辑
- [ ] 所有领域事件都有对应的监听器，监听器有幂等性保证

---

### 5. 入口层设计审查

**详细检查清单**：[chapter-05-checklist.md](./chapter-05-checklist.md)

核心验证：
- [ ] Controller 只允许 POST 接口，路径设计符合规范
- [ ] 所有接口使用 Param 对象和统一响应格式
- [ ] MQ 消费者保证幂等性，异常处理正确
- [ ] Task 层使用分布式锁，有监控指标

---

### 6. 架构一致性审查

#### 依赖方向
- [ ] 依赖方向正确
  - View → ViewModel → Service → Gateway → Network（iOS）
  - Controller → Application → Domain ← Gateway/Infra（Java）
  - View → Composable → Service → API → Request（Vue）

#### 分层清晰
- [ ] 分层清晰，职责明确
- [ ] 上层依赖下层，下层不依赖上层
- [ ] 依赖倒置正确

#### 命名规范
- [ ] 命名符合各层规范
- [ ] 命名统一，不混淆

---

### 7. 设计原则一致性

#### SOLID 原则
- [ ] 单一职责原则：每个类只有一个职责
- [ ] 里氏替换原则：子类可以替换父类
- [ ] 依赖倒置原则：依赖抽象而非具体
- [ ] 接口隔离原则：接口小而专注
- [ ] 开闭原则：对扩展开放，对修改关闭

#### DDD 原则
- [ ] 聚合尽可能小
- [ ] 聚合内强一致，聚合间最终一致
- [ ] 领域层不依赖任何其他层
- [ ] 应用层编排，领域层执行
- [ ] 入口层薄，不包含业务逻辑

---

## 快速验证

### 数量指标
- [ ] 限界上下文：3-8 个
- [ ] 聚合根：每个上下文 2-5 个
- [ ] 领域服务：每个上下文 2-5 个
- [ ] 应用服务：每个聚合 3-8 个方法
- [ ] 接口：每个聚合 3-8 个

### 质量指标
- [ ] 聚合大小：1-3 个实体，深度 1-2 层
- [ ] 事务粒度：一个事务一个聚合
- [ ] 业务逻辑：应用层无业务逻辑
- [ ] 接口方法：100% POST
- [ ] 参数类型：100% 使用 Param 对象
- [ ] 响应格式：100% 统一响应格式

### 文档完整性
- [ ] 上下文映射图
- [ ] 聚合图
- [ ] 领域服务图
- [ ] 应用层图
- [ ] 接口图

---

## 常见问题

**Q: 最终审查的目的是什么？**
A: 确保所有章节的设计一致，符合 DDD 原则，没有遗漏或冲突。

**Q: 如何验证设计的一致性？**
A: 检查依赖方向、分层清晰度、命名规范、设计原则的一致性。

**Q: 如果发现不一致怎么办？**
A: 回到相关章节，根据原则进行调整，确保整体设计一致。

**Q: 事件发布和事件处理分别在哪一章设计？**
A: v2.1 后，事件发布整合到第二章（聚合设计）的聚合根行为中，事件处理整合到第四章（应用层设计）的事件监听器中。

**Q: 为什么没有独立的领域事件审查？**
A: v2.1 更新删除了独立的领域事件章节，事件设计已整合到聚合设计和应用层设计中。

**Q: 最终审查需要多长时间？**
A: 通常 10-15 分钟，取决于设计的复杂度。

**Q: 最终审查通过后可以做什么？**
A: 可以开始编写代码，或者进行详细设计（如数据库设计、接口设计）。

---

## 审查通过标准

所有核心检查项（[ ]）都通过，即视为最终审查通过。

### 通过标准
- **及格线**：所有核心检查项 80% 以上通过
- **优秀线**：所有核心检查项 95% 以上通过

### 通过后可以
1. 开始编写代码
2. 进行详细设计
3. 编写技术文档

### 未通过需要
1. 回到相关章节
2. 根据原则调整设计
3. 重新进行最终审查
