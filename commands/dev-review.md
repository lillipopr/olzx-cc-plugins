---
description: 代码审查流程，planner 规划 → 执行审查 → 输出报告
---

# /dev-review - 代码审查流程

## 功能

启动代码审查流程，**严格的多阶段规划控制**：先规划审查范围，再执行审查，最后输出改进建议。

## 使用方式

```
/dev-review
/dev-review {审查范围}
```

## 完整流程

```
┌─────────────────────────────────────────────────────────────┐
│ Phase 1: 审查规划                                           │
│   planner → 规划审查范围和重点                              │
├─────────────────────────────────────────────────────────────┤
│ Phase 2: 执行审查                                           │
│   code-reviewer → 多维度代码审查                            │
├─────────────────────────────────────────────────────────────┤
│ Phase 3: 输出报告                                           │
│   生成审查报告和改进建议                                    │
└─────────────────────────────────────────────────────────────┘
```

## 启动提示

```
👀 启动代码审查流程

将按以下流程执行：
1. Phase 1: 审查规划（识别范围、定义重点）
2. Phase 2: 执行审查（多维度审查）
3. Phase 3: 输出报告（改进建议）

⚠️  严格的多阶段规划控制：
   - Phase 1 强制使用 planner 规划审查策略
   - Phase 2 执行多维度代码审查
   - Phase 3 输出可执行的改进建议

请描述您要审查的范围：
```

---

## Phase 1: 审查规划

### 调用 Planner

```
📋 Phase 1: 审查规划

请调用 planner，规划本阶段的审查策略：

规划要求：
1. 分析审查范围（文件/模块/全项目）
2. 识别审查维度（正确性/可读性/可维护性/性能/安全）
3. 定义审查重点
4. 规划审查步骤
5. 预估执行时间

输出格式参见 /dev 命令中的 "Planner 输出格式"
```

### 规划输出示例

```
## 审查规划

### 审查范围
- 审查类型: {全项目/指定模块/指定文件}
- 审查对象: {具体范围}

### 审查维度
- [ ] 正确性: 逻辑正确、边界处理、错误处理
- [ ] 可读性: 命名、注释、代码结构
- [ ] 可维护性: 设计原则、复杂度、耦合度
- [ ] 性能: 算法效率、资源使用
- [ ] 安全: 输入验证、敏感数据、权限控制

### 审查重点
1. {重点1}
2. {重点2}
...

### 审查步骤
1. {步骤1}
2. {步骤2}
...
```

---

## Phase 2: 执行审查

### 审查维度

#### 1. 正确性审查
```
检查项：
- [ ] 业务逻辑正确
- [ ] 边界条件处理
- [ ] 错误处理完整
- [ ] 异常场景覆盖
- [ ] 数据验证充分
```

#### 2. 可读性审查
```
检查项：
- [ ] 命名清晰（变量/函数/类）
- [ ] 注释充分（复杂逻辑/公共接口）
- [ ] 代码格式一致
- [ ] 结构清晰（缩进/换行/分段）
- [ ] 无魔法数字
```

#### 3. 可维护性审查
```
检查项：
- [ ] 遵循 SOLID 原则
- [ ] 单一职责
- [ ] 低耦合高内聚
- [ ] 圈复杂度合理（<10）
- [ ] 代码复用性好
```

#### 4. 性能审查
```
检查项：
- [ ] 算法效率合理
- [ ] 无内存泄漏
- [ ] 无死循环
- [ ] 资源正确释放
- [ ] 缓存策略合理
```

#### 5. 安全审查
```
检查项：
- [ ] 输入验证
- [ ] SQL 注入防护
- [ ] XSS 防护
- [ ] 敏感数据处理
- [ ] 权限控制
```

### 审查输出格式

```
## 代码审查报告

### 总体评分
- 正确性: {分数}/100
- 可读性: {分数}/100
- 可维护性: {分数}/100
- 性能: {分数}/100
- 安全: {分数}/100

### 问题汇总
- CRITICAL: {数量} 个
- HIGH: {数量} 个
- MEDIUM: {数量} 个
- LOW: {数量} 个

### 详细问题

#### CRITICAL 级别
1. [{文件}:{行}] {问题描述}
   - 原因: {原因分析}
   - 建议: {修复建议}

#### HIGH 级别
...

#### MEDIUM 级别
...

#### LOW 级别
...
```

---

## Phase 3: 输出报告

### 最终报告

```
📋 代码审查完成

## 总体评估
- 代码质量评分: {分数}/100
- 主要问题: {总结}
- 改进方向: {方向}

## 优先修复建议
1. [{CRITICAL}] {问题} - {建议}
2. [{HIGH}] {问题} - {建议}
3. [{MEDIUM}] {问题} - {建议}

## 良好实践
- {实践1}
- {实践2}
...

## 下一步
- [ ] 修复 CRITICAL 级别问题
- [ ] 修复 HIGH 级别问题
- [ ] 考虑 MEDIUM 级别改进
- [ ] 代码审查通过后创建 PR
```

### 问题级别定义

| 级别 | 描述 | 示例 | 处理优先级 |
|------|------|------|-----------|
| **CRITICAL** | 严重缺陷，必须修复 | 内存泄漏、安全漏洞、数据丢失风险 | 立即修复 |
| **HIGH** | 重要问题，应该修复 | 逻辑错误、性能问题、边界缺陷 | 高优先级 |
| **MEDIUM** | 一般问题，建议修复 | 可读性差、命名不清、小重构机会 | 中优先级 |
| **LOW** | 轻微问题，可选修复 | 格式问题、注释不足、微小改进 | 低优先级 |
