---
description: 创建 Pull Request，分析变更 → 生成摘要 → 创建 PR
---

# /dev-pr - 创建 Pull Request

## 功能

创建 Pull Request，**自动分析代码变更，生成全面的 PR 摘要和测试计划**。

## 使用方式

```
/dev-pr
/dev-pr {PR 标题}
```

## 完整流程

```
┌─────────────────────────────────────────────────────────────┐
│ Phase 1: 分析变更                                           │
│   分析 git 历史和 diff                                      │
├─────────────────────────────────────────────────────────────┤
│ Phase 2: 生成摘要                                           │
│   分析完整提交历史，起草 PR 摘要                             │
├─────────────────────────────────────────────────────────────┤
│ Phase 3: 创建 PR                                            │
│   使用 gh pr create 创建 Pull Request                       │
└─────────────────────────────────────────────────────────────┘
```

## 启动提示

```
🔀 准备创建 Pull Request

将按以下流程执行：
1. Phase 1: 分析变更（git diff 和 log）
2. Phase 2: 生成摘要（综合所有提交）
3. Phase 3: 创建 PR（使用 gh 命令）

⚠️  注意事项：
   - 确保已提交所有更改
   - 确保分支已推送到远程
   - 确保有 gh CLI 工具

请确认是否继续？
```

---

## Phase 1: 分析变更

### 检查 Git 状态

```
## 检查 Git 状态

### 当前状态
- 当前分支: {分支名}
- 跟踪分支: {远程分支}
- 是否有未提交更改: {是/否}

### 分支状态
- 是否领先远程: {提交数}
- 是否落后远程: {提交数}
- 是否需要推送: {是/否}
```

### 分析变更范围

```bash
# 执行以下命令分析变更
git status                    # 检查工作区状态
git log --oneline origin/main..HEAD  # 查看提交历史
git diff --stat origin/main...HEAD   # 查看变更统计
```

---

## Phase 2: 生成摘要

### 分析所有提交

```
## 分析完整提交历史

### 提交列表
1. {commit-hash} {commit-message}
2. {commit-hash} {commit-message}
...

### 变更类型统计
- feat: {数量}
- fix: {数量}
- refactor: {数量}
- docs: {数量}
- test: {数量}
- chore: {数量}

### 变更文件统计
- 总变更文件: {数量}
- 新增文件: {数量}
- 修改文件: {数量}
- 删除文件: {数量}
```

### 起草 PR 摘要

```
## PR 摘要草案

### 标题
{基于变更类型和内容自动生成}

### 描述
## 变更概述
{简要描述本次 PR 的目的和内容}

## 主要变更
{列出主要的功能变更和改进}

## 破坏性变更
{如有破坏性变更，在此说明}

## 测试计划
- [ ] 单元测试通过
- [ ] 集成测试通过
- [ ] E2E 测试通过
- [ ] 手动测试验证

## 检查清单
- [ ] 代码符合团队规范
- [ ] 测试覆盖率 ≥80%
- [ ] 文档已更新
- [ ] 无 console.log
- [ ] 无硬编码密钥

## 相关 Issue
Closes #{issue-number}

## 截图（如有 UI 变更）
{上传相关截图}
```

---

## Phase 3: 创建 PR

### 创建前检查

```
## 创建前检查清单

### Git 状态
- [ ] 所有更改已提交
- [ ] 分支已推送到远程
- [ ] 无未追踪的重要文件

### 代码质量
- [ ] 测试通过
- [ ] 覆盖率达标
- [ ] 代码已格式化
- [ ] 无 console.log

### 文档
- [ ] README 已更新（如需要）
- [ ] API 文档已更新（如需要）
- [ ] 变更日志已更新（如需要）

### 确认
以上所有检查项都已完成，是否继续创建 PR？
```

### 创建 PR 命令

```bash
# 使用 gh CLI 创建 PR
gh pr create \
  --title "{PR 标题}" \
  --body "$(cat <<'EOF'
## 变更概述
{变更概述}

## 主要变更
- {变更1}
- {变更2}

## 测试计划
- [ ] 单元测试通过
- [ ] 集成测试通过
- [ ] E2E 测试通过

## 检查清单
- [ ] 代码符合规范
- [ ] 测试覆盖率 ≥80%
- [ ] 文档已更新
EOF
)"
```

### 创建成功输出

```
✅ PR 创建成功

## PR 信息
- PR 编号: #{number}
- PR 标题: {title}
- PR 链接: {url}
- 基础分支: {base}
- 当前分支: {head}

## 下一步
- [ ] 通知团队审查
- [ ] 关注 CI/CD 状态
- [ ] 根据反馈修改
- [ ] 合并后清理分支
```

---

## PR 模板

### 功能开发 PR

```markdown
## 功能概述
{描述新增的功能}

## 变更内容
- 新增功能: {功能1}
- 修改功能: {功能2}
- 技术改进: {改进点}

## 测试
- 单元测试: {覆盖率}%
- 集成测试: ✅
- E2E 测试: ✅

## 截图/演示
{如有 UI 变更，提供截图或 GIF}

## 检查清单
- [ ] 遵循项目规范
- [ ] 测试充分
- [ ] 文档完整
```

### Bug 修复 PR

```markdown
## Bug 描述
{描述修复的 Bug}

## 根因分析
{分析 Bug 的根本原因}

## 修复方案
{描述如何修复}

## 验证
- 复现步骤: {步骤}
- 修复前: {行为}
- 修复后: {行为}
- 测试覆盖: ✅

## 回归测试
- [ ] 不影响其他功能
- [ ] 无性能退化

## 相关 Issue
Fixes #{issue-number}
```

### 重构 PR

```markdown
## 重构目标
{描述重构的目的}

## 重构内容
- 改进点1: {描述}
- 改进点2: {描述}

## 质量改善
- 圈复杂度: {重构前} → {重构后}
- 重复代码: {重构前} → {重构后}
- 可维护性: {改善描述}

## 验证
- [ ] 所有测试通过
- [ ] 无行为变化
- [ ] 性能无退化

## 相关 Issue
Ref #{issue-number}
```

---

## 常见问题

### Q: gh CLI 未安装怎么办？
**A:** 使用以下命令安装：
```bash
# macOS
brew install gh

# 登录
gh auth login
```

### Q: 如何更新 PR 描述？
**A:** 使用以下命令：
```bash
gh pr edit {pr-number} --body "$(cat <<'EOF'
{新的描述内容}
EOF
)"
```

### Q: 如何添加审阅者？
**A:** 在创建 PR 时添加：
```bash
gh pr create --reviewer {username1},{username2}
```
或在创建后添加：
```bash
gh pr edit {pr-number} --add-reviewer {username}
```

### Q: CI/CD 失败了怎么办？
**A:**
1. 查看 CI/CD 日志，找到失败原因
2. 修复问题
3. 推送修复，CI/CD 会自动重新运行
4. 如果是误报，可以重新运行
