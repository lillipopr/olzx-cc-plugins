---
description: 开发团队主入口，严格的多阶段规划控制流程
---

# /dev - 开发团队主入口

## 功能

开发团队主入口，根据开发场景智能路由到对应工作流。**每个阶段强制使用 planner 规划，严格控制执行步骤，防止 LLM 偷懒。**

## 使用方式

```
/dev              # 交互式选择场景
/dev feature      # 新功能开发（完整 4 Phase）
/dev fix          # Bug 修复
/dev refactor     # 代码重构
/dev review       # 代码审查
/dev test         # 测试相关
/dev security     # 安全审查
/dev pr           # 创建 Pull Request
```

## 执行流程

### 1. 场景识别
- 如果用户指定了场景，直接路由
- 否则询问用户选择

### 2. 严格的多阶段规划

每个阶段都遵循以下流程：

```
┌─────────────────────────────────────────────────────────┐
│  Phase N 开始                                           │
├─────────────────────────────────────────────────────────┤
│  1️⃣  planner(规划本阶段)                               │
│     → 拆解原子任务                                      │
│     → 定义验收标准                                      │
│     → 标记关键检查点                                    │
│     → 预估风险和应对方案                                │
├─────────────────────────────────────────────────────────┤
│  2️⃣  agent(按规划执行)                                 │
│     → 逐项执行规划步骤                                  │
│     → 每步完成后标记 ✓                                 │
│     → 遇到偏差及时汇报                                  │
├─────────────────────────────────────────────────────────┤
│  3️⃣  checkpoint(强制验收)                              │
│     → 检查所有规划步骤是否完成                          │
│     → 分析偏差和原因                                    │
│     → 决策：通过/补全/重新规划                          │
├─────────────────────────────────────────────────────────┤
│  ✅ 验收通过 → 进入下一 Phase                           │
└─────────────────────────────────────────────────────────┘
```

### 3. 架构识别
- 检测项目类型（Java/iOS/Frontend/Fullstack）
- 确定涉及的端（后端/前端/移动端）

### 4. 路由到对应的 Agent 和 Skill
- 根据场景和架构调用对应的 agent
- 引用对应的 skill
- 执行对应 workflow

## 场景选择提示

```
请选择开发场景：

1. 新功能开发     - 完整 4 Phase 流程（PRD → DDD → 建模 → 实现）
2. Bug 修复       - 用例补充 → 推导修复 → 验证
3. 代码重构       - 规划重构范围 → 执行 → 验证
4. 代码审查       - 安全审查 → 质量检查 → 改进建议
5. 测试相关       - 测试生成 → 覆盖率分析 → E2E 测试
6. 安全审查       - 安全检查 → 漏洞修复 → 验证
7. 创建 PR        - 生成变更摘要 → 测试计划 → 创建 PR

请输入数字或场景名称：
```

## 核心：严格的多阶段规划控制

### 为什么每个阶段都要用 Planner？

❌ **不使用 Planner 的风险：**
- LLM 可能跳过关键步骤
- 验收标准可能模糊
- 执行过程可能偏离目标
- 难以追溯和审计

✅ **每个阶段使用 Planner 的好处：**
- 原子化任务清单，可逐项验收
- 明确的验收标准，杜绝模糊
- 强制执行检查点，防止偷懒
- 完整的执行记录，可追溯

### Planner 输出格式（标准化）

每个阶段开始时，planner 必须输出：

```
## Phase N: {阶段名称} 执行规划

### 本阶段目标
- {目标1}
- {目标2}

### 原子任务清单（✅ 表示完成，⏳ 表示进行中，❌ 表示未开始）
- [ ] 步骤1: {任务描述}
  - 验收标准: {具体可检查的标准}
  - 输出物: {具体文件/文档}
  - 预估时间: X 分钟
- [ ] 步骤2: {任务描述}
  - 验收标准: {...}
  - 输出物: {...}
  - 预估时间: Y 分钟
...

### 关键检查点（必须全部通过才能进入下一阶段）
- [ ] 检查点1: {必须满足的条件}
- [ ] 检查点2: {...}

### 风险预案
- 风险1: {描述} → 应对: {措施}
- 风险2: {描述} → 应对: {措施}

### 预估工作量
- 总步骤数: N
- 预估总时间: X 分钟
```

### Checkpoint 验收机制

每个 Agent 执行完成后，强制执行 Checkpoint：

```
## 📋 Phase N Checkpoint

### 规划回顾
- 规划步骤数: {总数}
- 已完成: {数量} ✅
- 进行中: {数量} ⏳
- 未完成: {数量} ❌

### 逐项验收
- [ ] 步骤1: {状态} - {验收结果}
- [ ] 步骤2: {状态} - {验收结果}
...

### 偏差分析
- 跳过的步骤: {列出原因}
- 新增的步骤: {列出原因}
- 修改的验收标准: {列出原因}

### 决策
- [ ] ✅ 通过，所有检查点已满足，进入下一阶段
- [ ] ⚠️ 有偏差，需要补全以下内容: {列出}
- [ ] ❌ 严重偏离，需要重新规划本阶段

用户确认后继续...
```

## 关联的 Agent

### 新功能开发 (feature)
- Phase 1: `agents/product-manager/AGENT.md`
- Phase 2: `agents/domain-architect/AGENT.md`
- Phase 3: `agents/spec-compiler-v3/AGENT.md`
- Phase 4: 根据架构选择
  - Java: `agents/java-expert/AGENT.md`
  - iOS: `agents/ios-expert/AGENT.md`
  - Frontend: `agents/frontend-expert/AGENT.md`
  - Fullstack: 组合调用

### Bug 修复 (fix)
- `agents/tdd-expert/AGENT.md`
- 对应领域的 expert agent

### 代码重构 (refactor)
- `planner` (规划重构范围)
- 对应领域的 expert agent
- `code-reviewer` (验证重构结果)

## 关联的 Skill

根据具体场景和架构，引用对应的 skill：
- `skills/for-product-manager/SKILL.md`
- `skills/for-domain-architect/SKILL.md`
- `skills/for-spec-compiler-v3/SKILL.md`
- `skills/for-java-expert/SKILL.md`
- `skills/for-ios-expert/SKILL.md`
- `skills/for-frontend-expert/SKILL.md`
- `skills/for-tdd-expert/SKILL.md`

## 常见问题

### Q: 为什么要每个阶段都用 planner？
**A:** LLM 有"偷懒"倾向，可能会跳过步骤或简化验收标准。每个阶段使用 planner 可以：
1. 拆解原子任务，可逐项验收
2. 定义明确验收标准，杜绝模糊
3. 强制执行检查点，防止偷懒
4. 完整的执行记录，可追溯

### Q: checkpoint 失败了怎么办？
**A:** 有三种处理方式：
- ⚠️ 有偏差：补全缺失内容，然后继续
- ❌ 严重偏离：重新规划本阶段，然后执行
- ❌ 质量不合格：重新执行本阶段

### Q: 如何保证规划的质量？
**A:** Planner 必须遵循以下原则：
- 任务原子化：每个任务可独立验收
- 标准明确化：验收标准可量化/可检查
- 检查点强制：关键检查点必须全部通过
- 风险预判：提前识别风险并准备预案
